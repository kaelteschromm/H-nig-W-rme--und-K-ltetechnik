<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Kontakt & Angebot | Hünig Wärme- und Kältetechnik</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Service, Wartung, Störung, Erneuerung oder Neubau anfragen – Schritt für Schritt, danach Angebot per E-Mail.">
  <style>
    :root{
      --bg:#f7f7f7; --card:#fff; --text:#1a2433; --primary:#14365e; --muted:#5b6b82; --ring:rgba(0,0,0,.08);
      --accent:#e63a2e; --cool:#2e7bd9; --ok:#1a9e68; --warn:#c63c3c;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; background:var(--bg); color:var(--text); min-height:100vh; display:flex; flex-direction:column;}
    .wrap{max-width:900px;margin:0 auto;padding:0 20px}

    header{position:sticky;top:0;z-index:50;background:rgba(255,255,255,.85);backdrop-filter:blur(6px);border-bottom:1px solid #e6e8eb}
    .nav{display:flex;align-items:center;justify-content:space-between;height:64px}
    .brand{display:flex;align-items:center;gap:12px;font-weight:700;color:var(--primary);text-decoration:none}
    .brand img{height:36px;width:auto}
    nav a{color:var(--muted);text-decoration:none;margin-left:18px}
    nav a:hover{color:var(--primary)}

    main{padding:32px 0 24px}
    .card{background:var(--card);border-radius:16px;box-shadow:0 6px 24px var(--ring);padding:24px}

    h1{margin:0 0 6px;color:var(--primary);font-size:1.8rem}
    h2{margin:0 0 12px;color:var(--primary)}
    .sub{color:var(--muted);margin:0 0 12px}

    .progress{height:8px;background:#e6e8eb;border-radius:999px;overflow:hidden;margin:12px 0 20px}
    .bar{height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--cool));transition:width .25s}

    .step{display:none}
    .step.active{display:block}
    .q{font-weight:600;margin:8px 0 12px}
    .options{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:700px){ .options{grid-template-columns:1fr} }
    .opt{border:1px solid #e2e6eb;border-radius:12px;padding:12px;cursor:pointer;background:#fff;text-align:center}
    .opt:hover{border-color:#c9d3df}
    .opt.selected{border-color:var(--primary);box-shadow:0 0 0 3px rgba(20,54,94,.12)}
    .opt small{display:block;color:var(--muted);font-size:.9rem;margin-top:4px}

    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:700px){ .row{grid-template-columns:1fr} }
    .field{display:flex;flex-direction:column;gap:6px;margin:8px 0}
    label{font-size:.95rem;color:var(--primary)}
    input,select,textarea{border:1px solid #d6dde6;border-radius:10px;padding:10px 12px;font-size:1rem}
    textarea{min-height:120px;resize:vertical}

    .navbtns{display:flex;justify-content:space-between;gap:10px;margin-top:16px}
    .btn{display:inline-block;background:var(--primary);color:#fff;padding:10px 16px;border-radius:10px;text-decoration:none;border:0;cursor:pointer}
    .btn.secondary{background:#e6e8eb;color:#243041}
    .btn.success{background:var(--ok)}
    .hint{color:var(--muted);font-size:.95rem}
    .warn{color:var(--warn);font-size:.95rem}

    .sum{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:700px){ .sum{grid-template-columns:1fr} }
    .sum div{background:#f4f6f9;border:1px solid #e2e6eb;border-radius:12px;padding:12px}
    .sum b{color:var(--primary)}

    footer{margin-top:auto;border-top:1px solid #e6e8eb;background:#fff}
    .foot{display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between;padding:12px 20px;color:var(--muted);font-size:.95rem}
    .foot a{color:var(--muted);text-decoration:none;margin-right:14px}
    .foot a:hover{color:var(--primary)}
    .legal{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="wrap nav">
      <a class="brand" href="index.html"><img src="assets/logo-huenig.png" alt="Hünig Logo"><span>Hünig • Wärme- und Kältetechnik</span></a>
      <nav>
        <a href="index.html">Startseite</a>
        <a href="waermepumpen.html">Wärmepumpen</a>
        <a href="klimaanlagen.html">Klimaanlagen</a>
        <a href="lueftung.html">Lüftung</a>
        <a href="trinkwasserinstallationen.html">Trinkwasser</a>
        <a href="referenzen.html">Referenzen</a>
        <a href="service.html">Service & Wartung</a>
        <a href="ueber-uns.html">Über uns</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <div class="card">
      <h1>Was benötigen Sie?</h1>
      <p class="sub">Bitte wählen Sie Ihr Anliegen. Bei <b>Wartung / Service / Störung</b> öffnen wir sofort das Kontaktformular. Bei <b>Erneuerung / Neubau</b> fragen wir einige Details (Fläche, Baujahr, Heizung etc.).</p>

      <div class="progress" aria-label="Fortschritt">
        <div class="bar" id="bar"></div>
      </div>

      <!-- STEP 1: Anliegen -->
      <section class="step active" data-step="1" id="step1">
        <div class="q">Worum geht es?</div>
        <div class="options" role="listbox" aria-label="Anliegen wählen">
          <button class="opt" data-key="anliegen" data-value="Service">Service <small>Termin anfragen</small></button>
          <button class="opt" data-key="anliegen" data-value="Wartung">Wartung <small>regelmäßige Inspektion</small></button>
          <button class="opt" data-key="anliegen" data-value="Störung">Störung <small>Gerät funktioniert nicht</small></button>
          <button class="opt" data-key="anliegen" data-value="Erneuerung">Erneuerung <small>Altanlage ersetzen</small></button>
          <button class="opt" data-key="anliegen" data-value="Neubau">Neubau <small>Erstanlage planen</small></button>
        </div>
        <div class="navbtns">
          <span></span>
          <button class="btn" data-next>Nächster Schritt</button>
        </div>
      </section>

      <!-- BRANCH A: Sofortformular für Service/Wartung/Störung -->
      <section class="step" data-step="A" id="stepA">
        <h2>Schnellanfrage – <span id="branchLabel"></span></h2>
        <div class="row">
          <div class="field">
            <label>Kundentyp *</label>
            <div class="options">
              <button class="opt" data-key="kundentyp" data-value="Bestandskunde">Bestandskunde</button>
              <button class="opt" data-key="kundentyp" data-value="Neukunde">Neukunde</button>
            </div>
          </div>
          <div class="field">
            <label for="kundennummer">Kundennummer (falls bekannt)</label>
            <input id="kundennummer" placeholder="z. B. HUE-01234" />
          </div>
        </div>
        <div class="row">
          <div class="field">
            <label for="geraetemarke">Gerätemarke</label>
            <input id="geraetemarke" placeholder="z. B. Viessmann/Daikin/Samsung" />
          </div>
          <div class="field">
            <label for="modell">Modell</label>
            <input id="modell" placeholder="z. B. Typ/Modellnummer" />
          </div>
        </div>
        <div class="field">
          <label for="beschreibung">Kurzbeschreibung *</label>
          <textarea id="beschreibung" placeholder="z. B. Fehlermeldung, Symptome, gewünschter Servicetermin" required></textarea>
        </div>

        <h2>Ihre Kontaktdaten</h2>
        <div class="row">
          <div class="field"><label for="nameA">Name *</label><input id="nameA" required placeholder="Vor- und Nachname" /></div>
          <div class="field"><label for="emailA">E-Mail *</label><input type="email" id="emailA" required placeholder="ihre.email@beispiel.de" /></div>
        </div>
        <div class="row">
          <div class="field"><label for="telefonA">Telefon</label><input id="telefonA" placeholder="+49 ..." /></div>
          <div class="field"><label for="adresseA">Adresse</label><input id="adresseA" placeholder="Straße, Hausnummer, PLZ Ort" /></div>
        </div>
        <p class="hint">Nach dem Absenden erhalten Sie eine Bestätigung per E-Mail.</p>
        <div class="navbtns">
          <button class="btn secondary" data-prev>Zurück</button>
          <button class="btn success" id="sendBtnA">Anfrage absenden</button>
        </div>
      </section>

      <!-- BRANCH B: Wizard für Erneuerung/Neubau -->
      <section class="step" data-step="2">
        <div class="q">Objektart</div>
        <div class="options">
          <button class="opt" data-key="objekt" data-value="Wohnung">Wohnung</button>
          <button class="opt" data-key="objekt" data-value="Einfamilienhaus">Einfamilienhaus</button>
          <button class="opt" data-key="objekt" data-value="Mehrfamilienhaus">Mehrfamilienhaus</button>
          <button class="opt" data-key="objekt" data-value="Gewerbe">Gewerbe</button>
        </div>
        <div class="row">
          <div class="field"><label for="flaeche">Wohn-/Nutzfläche (m²) *</label><input type="number" id="flaeche" min="1" placeholder="z. B. 120" /></div>
          <div class="field"><label for="baujahr">Baujahr *</label><input type="number" id="baujahr" min="1800" max="2100" placeholder="z. B. 1998" /></div>
        </div>
        <div class="navbtns">
          <button class="btn secondary" data-prev>Zurück</button>
          <button class="btn" data-next>Nächster Schritt</button>
        </div>
      </section>

      <section class="step" data-step="3">
        <div class="q">Sanierungsstand *</div>
        <div class="options">
          <button class="opt" data-key="sanierung" data-value="keine">Keine</button>
          <button class="opt" data-key="sanierung" data-value="teilweise">Teilweise (Fenster/Dämmung)</button>
          <button class="opt" data-key="sanierung" data-value="umfassend">Umfassend</button>
        </div>

        <div class="q" style="margin-top:14px">Wärmeabgabe *</div>
        <div class="options">
          <button class="opt" data-key="abgabe" data-value="Heizkörper">Heizkörper</button>
          <button class="opt" data-key="abgabe" data-value="Fußbodenheizung">Fußbodenheizung</button>
          <button class="opt" data-key="abgabe" data-value="Beides">Beides</button>
        </div>

        <div class="q" style="margin-top:14px">Bisherige Heizart *</div>
        <div class="options">
          <button class="opt" data-key="altanlage" data-value="Gas">Gas</button>
          <button class="opt" data-key="altanlage" data-value="Öl">Öl</button>
          <button class="opt" data-key="altanlage" data-value="Pellet">Pellet</button>
          <button class="opt" data-key="altanlage" data-value="Nachtspeicher">Nachtspeicher</button>
          <button class="opt" data-key="altanlage" data-value="Fernwärme">Fernwärme</button>
          <button class="opt" data-key="altanlage" data-value="Keine/Neu">Keine / Neu</button>
          <button class="opt" data-key="altanlage" data-value="Andere">Andere</button>
        </div>

        <div class="navbtns">
          <button class="btn secondary" data-prev>Zurück</button>
          <button class="btn" data-next>Nächster Schritt</button>
        </div>
      </section>

      <section class="step" data-step="4">
        <div class="q">Was ist gewünscht?</div>
        <div class="options">
          <button class="opt" data-key="wunsch" data-value="Wärmepumpe">Wärmepumpe</button>
          <button class="opt" data-key="wunsch" data-value="Klimaanlage">Klimaanlage</button>
          <button class="opt" data-key="wunsch" data-value="Lüftung">Lüftung</button>
          <button class="opt" data-key="wunsch" data-value="Trinkwasser">Trinkwasser</button>
        </div>

        <div class="q" style="margin-top:14px">Wie schnell soll es gehen?</div>
        <div class="options">
          <button class="opt" data-key="zeit" data-value="sofort">Sofort / dringend</button>
          <button class="opt" data-key="zeit" data-value="3monate">In den nächsten 3 Monaten</button>
          <button class="opt" data-key="zeit" data-value="6monate">In 3–6 Monaten</button>
          <button class="opt" data-key="zeit" data-value="flexibel">Flexibel / nach Absprache</button>
        </div>

        <div class="field">
          <label for="bemerkung">Zusatzinfo (optional)</label>
          <textarea id="bemerkung" placeholder="z. B. gewünschte Marke/Leistung, aktuelle Probleme, Fotos folgen per Mail"></textarea>
        </div>

        <div class="navbtns">
          <button class="btn secondary" data-prev>Zurück</button>
          <button class="btn" data-next>Nächster Schritt</button>
        </div>
      </section>

      <section class="step" data-step="5">
        <div class="row">
          <div class="field"><label for="plz">PLZ / Ort *</label><input id="plz" placeholder="z. B. 69120 Heidelberg" /></div>
          <div class="field"><label for="bewohner">Anzahl Bewohner *</label><input type="number" id="bewohner" min="1" placeholder="z. B. 3" /></div>
        </div>
        <div class="field"><label for="adresse">Straße & Hausnummer *</label><input id="adresse" placeholder="z. B. Musterstraße 12" /></div>
        <div class="navbtns">
          <button class="btn secondary" data-prev>Zurück</button>
          <button class="btn" data-next>Nächster Schritt</button>
        </div>
      </section>

      <section class="step" data-step="6">
        <div class="q">Ihre Angaben (Zusammenfassung)</div>
        <div class="sum" id="summary"></div>

        <hr style="border:none;border-top:1px solid #e6e8eb;margin:16px 0">

        <div class="row">
          <div class="field"><label for="nameB">Ihr Name *</label><input id="nameB" required placeholder="Vor- und Nachname" /></div>
          <div class="field"><label for="emailB">E-Mail *</label><input type="email" id="emailB" required placeholder="ihre.email@beispiel.de" /></div>
        </div>
        <div class="row">
          <div class="field"><label for="telefonB">Telefon</label><input id="telefonB" placeholder="+49 ..." /></div>
          <div class="field"><label for="wunschterminB">Wunschtermin</label><input id="wunschterminB" placeholder="z. B. KW 45" /></div>
        </div>
        <div class="field"><label for="nachrichtB">Nachricht (optional)</label><textarea id="nachrichtB" placeholder="Weitere Hinweise, Erreichbarkeit …"></textarea></div>

        <p class="hint">Beim Absenden werden Ihre Angaben per E-Mail an uns gesendet. Sie erhalten eine Bestätigung.</p>
        <p class="warn" id="errB" style="display:none">Bitte füllen Sie mindestens Name, E-Mail und die Pflichtfelder aus.</p>

        <div class="navbtns">
          <button class="btn secondary" data-prev>Zurück</button>
          <button class="btn success" id="sendBtnB">Anfrage absenden</button>
        </div>
      </section>
    </div>
  </main>

  <footer>
    <div class="wrap foot">
      <div>© <span id="y"></span> Hünig Wärme- und Kältetechnik</div>
      <div class="legal" aria-label="Rechtliche Links">
        <a href="impressum.html">Impressum</a>
        <a href="datenschutz.html">Datenschutz</a>
        <a href="agb.html">AGB</a>
        <a href="nutzungsbedingungen.html">Nutzungsbedingungen</a>
        <a href="kontakt.html">Kontakt</a>
      </div>
    </div>
  </footer>

  <script>
    document.getElementById('y').textContent = new Date().getFullYear();

    const steps = Array.from(document.querySelectorAll('.step'));
    const bar = document.getElementById('bar');
    let current = 0;
    const data = {};

    const SEND_TO = 'FORM_ENDPOINT_HIER_EINSETZEN'; // z.B. https://formspree.io/f/abcdxyz

    function updateProgress(){
      const visibleSteps = steps.filter(s => s.style.display !== 'none' || s.classList.contains('active'));
      const idx = visibleSteps.indexOf(steps[current]);
      const total = visibleSteps.length;
      const pct = Math.max(0, ((idx+1) / total) * 100);
      bar.style.width = pct + '%';
    }
    function showStep(i){
      steps.forEach((s, idx)=> s.classList.toggle('active', idx===i));
      current = i;
      updateProgress();
      // Branch-Label setzen
      if (steps[i].dataset.step === 'A') {
        document.getElementById('branchLabel').textContent = data.anliegen || '';
      }
      if (steps[i].dataset.step === '6') renderSummary();
    }
    updateProgress();

    // Single-select options
    document.querySelectorAll('.options').forEach(group=>{
      group.addEventListener('click', (e)=>{
        const btn = e.target.closest('.opt');
        if(!btn) return;
        group.querySelectorAll('.opt').forEach(o=>o.classList.remove('selected'));
        btn.classList.add('selected');
        const key = btn.dataset.key;
        const value = btn.dataset.value;
        if (key) data[key] = value;
      });
    });

    // Next/Prev
    document.querySelectorAll('[data-next]').forEach(b=>{
      b.addEventListener('click', ()=>{
        const stepId = steps[current].dataset.step;

        // Branching-Logik nach Step 1
        if (stepId === '1'){
          if (!data.anliegen) return alert('Bitte Anliegen wählen.');
          // Wenn Service/Wartung/Störung -> direkt zu A
          if (['Service','Wartung','Störung'].includes(data.anliegen)){
            // Zeige nur Step1 + StepA
            steps.forEach(s => {
              const keep = ['1','A'].includes(s.dataset.step);
              if (!keep) s.style.display = 'none';
              else s.style.display = '';
            });
            showStep(1); // Step A Index (nach dem Reduzieren ist es 1)
            return;
          } else {
            // Erneuerung/Neubau -> normalen Wizard (Steps 1..6), StepA ausblenden
            steps.forEach(s => {
              s.style.display = '';
              if (s.dataset.step === 'A') s.style.display = 'none';
            });
          }
        }

        // Validierungen
        if (stepId==='2'){ // Objekt/Basisdaten
          if (!data.objekt) return alert('Bitte Objektart wählen.');
          const fl = document.getElementById('flaeche').value.trim();
          const bj = document.getElementById('baujahr').value.trim();
          if (!fl || !bj) return alert('Bitte Fläche und Baujahr eintragen.');
          data.flaeche = fl; data.baujahr = bj;
        }
        if (stepId==='3'){ // Sanierung/Abgabe/Altanlage
          if (!data.sanierung) return alert('Bitte Sanierungsstand wählen.');
          if (!data.abgabe) return alert('Bitte Wärmeabgabe wählen.');
          if (!data.altanlage) return alert('Bitte bisherige Heizart wählen.');
        }
        if (stepId==='4'){ // Wunsch/Zeithorizont
          if (!data.wunsch) return alert('Bitte Wunsch auswählen.');
          if (!data.zeit) return alert('Bitte Zeitrahmen wählen.');
          data.bemerkung = document.getElementById('bemerkung').value.trim();
        }
        if (stepId==='5'){ // Adresse/Bewohner
          const plz = document.getElementById('plz').value.trim();
          const adr = document.getElementById('adresse').value.trim();
          const bew = document.getElementById('bewohner').value.trim();
          if (!plz || !adr || !bew) return alert('Bitte PLZ/Ort, Straße und Anzahl Bewohner angeben.');
          data.plz = plz; data.adresse = adr; data.bewohner = bew;
        }

        if (current < steps.length-1) {
          // Überspringe ggf. versteckte Steps (Branching)
          let next = current + 1;
          while (next < steps.length && steps[next].style.display === 'none') next++;
          showStep(next);
        }
      });
    });
    document.querySelectorAll('[data-prev]').forEach(b=> b.addEventListener('click', ()=>{
      let prev = current - 1;
      while (prev >= 0 && steps[prev].style.display === 'none') prev--;
      showStep(Math.max(0, prev));
    }));

    function renderSummary(){
      const el = document.getElementById('summary');
      el.innerHTML = `
        <div><b>Anliegen:</b><br>${data.anliegen||'-'}</div>
        <div><b>Objekt:</b><br>${data.objekt||'-'}</div>
        <div><b>Fläche (m²):</b><br>${data.flaeche||'-'}</div>
        <div><b>Baujahr:</b><br>${data.baujahr||'-'}</div>
        <div><b>Sanierung:</b><br>${data.sanierung||'-'}</div>
        <div><b>Wärmeabgabe:</b><br>${data.abgabe||'-'}</div>
        <div><b>Bisherige Heizart:</b><br>${data.altanlage||'-'}</div>
        <div><b>Wunsch:</b><br>${data.wunsch||'-'}</div>
        <div><b>Zeitrahmen:</b><br>${data.zeit||'-'}</div>
        <div><b>PLZ/Ort:</b><br>${data.plz||'-'}</div>
        <div><b>Straße:</b><br>${data.adresse||'-'}</div>
        <div><b>Bewohner:</b><br>${data.bewohner||'-'}</div>
        <div style="grid-column:1/-1"><b>Zusatzinfo:</b><br>${(data.bemerkung||'').replace(/\n/g,'<br>')||'-'}</div>
      `;
    }

    async function sendToFormspree(payload){
      try{
        const res = await fetch(SEND_TO, {
          method:'POST',
          headers: { 'Accept': 'application/json', 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        return res.ok;
      }catch(e){ return false; }
    }

    // Branch A: sofort senden
    document.getElementById('sendBtnA').addEventListener('click', async ()=>{
      const required = ['anliegen'];
      if (!data.anliegen) { alert('Bitte Anliegen wählen.'); showStep(0); return; }

      const name = document.getElementById('nameA').value.trim();
      const email = document.getElementById('emailA').value.trim();
      if (!name || !email) { alert('Bitte Name und E-Mail angeben.'); return; }

      data.kundentyp = data.kundentyp || 'Neukunde';
      const payload = {
        to: "kaelteschromm@gmail.com",
        _subject: `Schnellanfrage (${data.anliegen}) über huenig.com`,
        _page: location.href,
        anliegen: data.anliegen,
        kundentyp: data.kundentyp,
        kundennummer: document.getElementById('kundennummer').value.trim(),
        geraetemarke: document.getElementById('geraetemarke').value.trim(),
        modell: document.getElementById('modell').value.trim(),
        beschreibung: document.getElementById('beschreibung').value.trim(),
        name, email,
        telefon: document.getElementById('telefonA').value.trim(),
        adresse: document.getElementById('adresseA').value.trim()
      };
      if (!payload.beschreibung) { alert('Bitte Kurzbeschreibung ausfüllen.'); return; }

      const ok = await sendToFormspree(payload);
      alert(ok ? 'Danke! Ihre Anfrage wurde gesendet.' : 'Senden fehlgeschlagen. Bitte später erneut versuchen oder per E-Mail.');
      if (ok) location.href = 'index.html';
    });

    // Branch B: Wizard senden
    document.getElementById('sendBtnB').addEventListener('click', async ()=>{
      const name = document.getElementById('nameB').value.trim();
      const email = document.getElementById('emailB').value.trim();
      if (!name || !email) { document.getElementById('errB').style.display='block'; return; }

      const summaryText = `
Anliegen: ${data.anliegen||'-'}
Objekt: ${data.objekt||'-'}
Fläche (m²): ${data.flaeche||'-'}
Baujahr: ${data.baujahr||'-'}
Sanierung: ${data.sanierung||'-'}
Wärmeabgabe: ${data.abgabe||'-'}
Bisherige Heizart: ${data.altanlage||'-'}
Wunsch: ${data.wunsch||'-'}
Zeitrahmen: ${data.zeit||'-'}
PLZ/Ort: ${data.plz||'-'}
Straße: ${data.adresse||'-'}
Bewohner: ${data.bewohner||'-'}
Zusatzinfo: ${(data.bemerkung||'')}
      `.trim();

      const payload = {
        to: "kaelteschromm@gmail.com",
        _subject: "Neue Anfrage (Erneuerung/Neubau) über huenig.com",
        _page: location.href,
        'Zusammenfassung': summaryText,
        name, email,
        telefon: document.getElementById('telefonB').value.trim(),
        wunschtermin: document.getElementById('wunschterminB').value.trim(),
        nachricht: document.getElementById('nachrichtB').value.trim(),
        ...data
      };

      const ok = await sendToFormspree(payload);
      alert(ok ? 'Danke! Ihre Anfrage wurde gesendet.' : 'Senden fehlgeschlagen. Bitte später erneut versuchen oder per E-Mail.');
      if (ok) location.href = 'index.html';
    });

    // Next/Prev Buttons
    document.querySelectorAll('[data-prev]').forEach(b=> b.addEventListener('click', ()=>{
      let prev = current - 1;
      while (prev >= 0 && steps[prev].style.display === 'none') prev--;
      showStep(Math.max(0, prev));
    }));

    document.querySelectorAll('[data-next]').forEach(b=>{
      b.addEventListener('click', ()=>{
        const stepId = steps[current].dataset.step;

        if (stepId === '1'){
          if (!data.anliegen) return alert('Bitte Anliegen wählen.');
          if (['Service','Wartung','Störung'].includes(data.anliegen)){
            steps.forEach(s => { const keep = ['1','A'].includes(s.dataset.step); s.style.display = keep ? '' : 'none'; });
            showStep(1); // A
            return;
          } else {
            steps.forEach(s => { s.style.display = s.dataset.step === 'A' ? 'none' : ''; });
          }
        }

        if (stepId==='2'){
          if (!data.objekt) return alert('Bitte Objektart wählen.');
          const fl = document.getElementById('flaeche').value.trim();
          const bj = document.getElementById('baujahr').value.trim();
          if (!fl || !bj) return alert('Bitte Fläche und Baujahr eintragen.');
          data.flaeche = fl; data.baujahr = bj;
        }
        if (stepId==='3'){
          if (!data.sanierung) return alert('Bitte Sanierungsstand wählen.');
          if (!data.abgabe) return alert('Bitte Wärmeabgabe wählen.');
          if (!data.altanlage) return alert('Bitte bisherige Heizart wählen.');
        }
        if (stepId==='4'){
          if (!data.wunsch) return alert('Bitte Wunsch auswählen.');
          if (!data.zeit) return alert('Bitte Zeitrahmen wählen.');
          data.bemerkung = document.getElementById('bemerkung').value.trim();
        }
        if (stepId==='5'){
          const plz = document.getElementById('plz').value.trim();
          const adr = document.getElementById('adresse').value.trim();
          const bew = document.getElementById('bewohner').value.trim();
          if (!plz || !adr || !bew) return alert('Bitte PLZ/Ort, Straße und Anzahl Bewohner angeben.');
          data.plz = plz; data.adresse = adr; data.bewohner = bew;
        }

        if (current < steps.length-1) {
          let next = current + 1;
          while (next < steps.length && steps[next].style.display === 'none') next++;
          showStep(next);
        }
      });
    });
  </script>
</body>
</html>
